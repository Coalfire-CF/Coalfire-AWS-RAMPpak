- name: Populate service facts
  ansible.builtin.service_facts:

- name: Assert that Services are not failed
  ansible.builtin.assert:
    that:
      - ansible_facts.services[item].status != 'failed'
    fail_msg: "{{ item }} is failed"
    success_msg: "{{ item }} is not failed"
  with_items: "{{ ansible_facts.services }}"
